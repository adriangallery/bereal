<!-- components/menu2.html -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand" href="index.html">$ADRIAN</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="index.html">Index</a></li>
        <li class="nav-item"><a class="nav-link" href="auction.html">Adrian Auction</a></li>
        <li class="nav-item"><a class="nav-link" href="pumpit.html">Pump your ADRIANS</a></li>
        <li class="nav-item"><a class="nav-link" href="filthyrich.html">Filthy Rich</a></li>
        <li class="nav-item"><a class="nav-link" href="taxreaper.html">The TAX reaper</a></li>
        <li class="nav-item"><a class="nav-link" href="holdings.html">Your holdings</a></li>
        <li class="nav-item"><a class="nav-link" href="burnstats.html">Burn Stats</a></li>
        <li class="nav-item"><a class="nav-link" href="claim.html">METAMORPH</a></li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/adriancerda" target="_blank">Twitter</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://discord.gg/YHc5Sh65Hm" target="_blank">Discord</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://opensea.io/collection/adriangallery" target="_blank">OpenSea</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://dexscreener.com/base/0xa51d80c15b0b67b9f32865d3351977a7006c462f" target="_blank">Chart</a>
        </li>
      </ul>
      <!-- Botón "Connect Wallet" -->
      <button class="btn btn-outline-info ms-lg-3" id="menuConnectButton" onclick="menuConnectWallet()">
        Connect Wallet
      </button>
    </div>
  </div>
</nav>

<!-- Incluir ethers.js (si no se ha incluido ya en la página) -->
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<script>
  // Variables globales para el menú
  window.menuProvider = null;
  window.menuSigner = null;
  window.menuUserAccount = null;

  async function menuConnectWallet() {
    console.log("menuConnectWallet() invoked");
    if (window.ethereum) {
      window.menuProvider = new ethers.providers.Web3Provider(window.ethereum);
      try {
        console.log("Requesting accounts from menu...");
        await window.menuProvider.send("eth_requestAccounts", []);
        window.menuSigner = window.menuProvider.getSigner();
        window.menuUserAccount = await window.menuSigner.getAddress();
        console.log("Menu connected account:", window.menuUserAccount);
        // Muestra la dirección en formato abreviado
        document.getElementById("menuConnectButton").textContent =
          window.menuUserAccount.slice(0, 6) + "..." + window.menuUserAccount.slice(-4);

        // Si la página que incluye el menú define una función onMenuWalletConnected,
        // se invoca para actualizar la interfaz (por ejemplo, balance o NFTs)
        if (typeof window.onMenuWalletConnected === "function") {
          window.onMenuWalletConnected();
        }
      } catch (error) {
        console.error("Error connecting wallet in menu:", error);
        alert("Error connecting wallet from menu. Check the console for details.");
      }
    } else {
      alert("MetaMask is not installed!");
    }
  }

  // Verifica si el usuario ya está conectado (por ejemplo, si refrescó la página)
  document.addEventListener("DOMContentLoaded", async () => {
    if (window.ethereum) {
      const provider = new ethers.providers.Web3Provider(window.ethereum);
      const accounts = await provider.listAccounts();
      if (accounts.length > 0) {
        window.menuProvider = provider;
        window.menuSigner = provider.getSigner();
        window.menuUserAccount = accounts[0];
        const btn = document.getElementById("menuConnectButton");
        if (btn) {
          btn.textContent =
            window.menuUserAccount.slice(0, 6) + "..." + window.menuUserAccount.slice(-4);
        }
        if (typeof window.onMenuWalletConnected === "function") {
          window.onMenuWalletConnected();
        }
      }
    }
  });
</script>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>$ADRIAN Auction - Admin NFT Config</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Ethers.js -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body { background-color: #f8f9fa; }
    .container { margin-top: 2rem; }
    .section-title { margin-top: 2rem; margin-bottom: 1rem; font-weight: bold; }
    .form-group { margin-bottom: 1rem; }
  </style>
</head>
<body>
  <div class="container">
    <h1>$ADRIAN Auction - Admin NFT Configuration</h1>
    <button id="connectWalletBtn" class="btn btn-primary">Connect Wallet</button>
    <p id="walletAddress"></p>

    <div class="card mt-4">
      <div class="card-header">NFT Configuration</div>
      <div class="card-body">
        <div class="form-group">
          <label for="nftContract">Global NFT Contract Address:</label>
          <input type="text" id="nftContract" class="form-control" placeholder="0x...">
        </div>
        <div class="form-group mt-3">
          <div class="form-check">
            <input type="checkbox" id="is1155" class="form-check-input">
            <label class="form-check-label" for="is1155">ERC1155?</label>
          </div>
        </div>
        <div class="form-group mt-3">
          <label for="commonRewards">Common Reward NFTs (JSON array, 10 items required):</label>
          <textarea id="commonRewards" class="form-control" rows="4" placeholder='e.g., 
[
  {"nftContract": "0x62eb92B403cD5D6E9B20b51f27B96552cD9f8bcD", "tokenId": 19, "is1155": true, "amount": 1},
  {"nftContract": "0x62eb92B403cD5D6E9B20b51f27B96552cD9f8bcD", "tokenId": 19, "is1155": true, "amount": 1},
  ... (10 items total)
]
'></textarea>
        </div>
        <div class="form-group mt-3">
          <label for="winnerReward">Winner Reward NFT (JSON object):</label>
          <textarea id="winnerReward" class="form-control" rows="2" placeholder='e.g., {"nftContract": "0x62eb92B403cD5D6E9B20b51f27B96552cD9f8bcD", "tokenId": 18, "is1155": true, "amount": 1}'></textarea>
        </div>
        <button id="updateNFTConfigBtn" class="btn btn-success mt-3">Update NFT Configuration</button>
      </div>
    </div>

    <div id="status" class="mt-3"></div>
  </div>
  
  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Admin Panel JavaScript -->
  <script>
    let provider, signer, auctionContract;
    let userAccount = "";
    // Direcci칩n del nuevo contrato de subasta V4
    const auctionAddress = "0xb6f46540cad3d8ea7568e0acb2e48fad72cb6ee0";
    // Direcci칩n del token $ADRIAN
    const tokenAddress = "0x7E99075Ce287F1cF8cBCAaa6A1C7894e404fD7Ea";
    
    // ABI de las funciones administrativas (updateNftContract, setCommonRewardNFTs, setWinnerRewardNFTs)
    const auctionABI = [
      "function updateNftContract(address newNftContract, bool _is1155) external",
      "function setCommonRewardNFTs(tuple(address nftContract, uint256 tokenId, bool is1155, uint256 amount)[] calldata rewards) external",
      "function setWinnerRewardNFTs(tuple(address nftContract, uint256 tokenId, bool is1155, uint256 amount)[] calldata rewards) external"
    ];
    
    async function connectWallet() {
      if (window.ethereum) {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        userAccount = await signer.getAddress();
        document.getElementById("walletAddress").innerText = "Connected: " + userAccount;
        auctionContract = new ethers.Contract(auctionAddress, auctionABI, signer);
      } else {
        alert("No Ethereum provider found. Please install MetaMask.");
      }
    }
    
    async function updateNFTConfig() {
      const nftContractInput = document.getElementById("nftContract").value;
      const is1155 = document.getElementById("is1155").checked;
      const commonRewardsJSON = document.getElementById("commonRewards").value;
      const winnerRewardJSON = document.getElementById("winnerReward").value;
      
      if (!nftContractInput || !commonRewardsJSON || !winnerRewardJSON) {
        alert("Please fill in all fields.");
        return;
      }
      
      let commonRewards;
      let winnerReward;
      try {
        commonRewards = JSON.parse(commonRewardsJSON);
      } catch (e) {
        alert("Invalid JSON for Common Reward NFTs.");
        return;
      }
      
      try {
        // Parse winner reward as object and wrap it in an array
        winnerReward = [JSON.parse(winnerRewardJSON)];
      } catch (e) {
        alert("Invalid JSON for Winner Reward NFT.");
        return;
      }
      
      const statusDiv = document.getElementById("status");
      statusDiv.innerText = "Updating NFT configuration...";
      
      try {
        // Actualiza la direcci칩n global del NFT y su est치ndar
        let tx = await auctionContract.updateNftContract(nftContractInput, is1155);
        statusDiv.innerText = "Updating NFT contract...";
        await tx.wait();
        
        // Configura los Common Reward NFTs
        tx = await auctionContract.setCommonRewardNFTs(commonRewards);
        statusDiv.innerText = "Setting common reward NFTs...";
        await tx.wait();
        
        // Configura el Winner Reward NFT
        tx = await auctionContract.setWinnerRewardNFTs(winnerReward);
        statusDiv.innerText = "Setting winner reward NFT...";
        await tx.wait();
        
        statusDiv.innerText = "NFT configuration updated successfully.";
      } catch (error) {
        console.error(error);
        statusDiv.innerText = "Error updating NFT configuration: " + error.message;
      }
    }
    
    document.getElementById("connectWalletBtn").addEventListener("click", connectWallet);
    document.getElementById("updateNFTConfigBtn").addEventListener("click", updateNFTConfig);
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="https://files.catbox.moe/ffvdjy.svg" type="image/svg+xml">
  <meta charset="UTF-8">
  <title>$ADRIAN CLAIM - THE BURNED FORTUNE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap CSS (v5.3.0) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Custom CSS -->
  <link href="css/styles.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
    }
    /* Estilos propios para el claim */
    #claimSection {
      background: #222;
      color: #fff;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(255,255,255,0.1);
      margin-bottom: 2rem;
    }
    #conditions p {
      margin: 5px 0;
    }
    /* Hero con imagen del NFT */
    .hero {
      background: url('https://emerald-above-tick-265.mypinata.cloud/ipfs/bafybeihnmvtpqkibywrfmpleedvqpuclyk7sqgi5vfgvn4q37nthirxle4') no-repeat center center;
      background-size: cover;
      padding: 4rem 0;
      color: #fff;
      text-shadow: 0 0 5px #000;
    }
    .hero h1 {
      font-weight: bold;
    }
    /* Estilos para mostrar metadatos del NFT */
    .nft-details {
      text-align: left;
      background: rgba(0,0,0,0.3);
      padding: 15px;
      border-radius: 10px;
      margin-top: 1rem;
    }
  </style>
  <!-- Ethers.js UMD (para que ethers est茅 global) -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
  <!-- Menu (Header) -->
  <div id="menu-placeholder"></div>
  <script>
    // Cargar el men煤 desde components/menu2.html (aseg煤rate de tenerlo actualizado)
    fetch('components/menu2.html')
      .then(response => response.text())
      .then(html => { document.getElementById('menu-placeholder').innerHTML = html; })
      .catch(error => { console.error('Error loading menu:', error); });
  </script>
  <!-- Cargar la l贸gica del men煤 -->
  <script src="components/menu2.js"></script>
  
  <!-- Hero Section -->
  <section class="hero text-center">
    <div class="container">
      <h1>Claim your NFT now!</h1>
      <p class="lead">Burn 100K $ADRIAN tokens to claim your exclusive NFT.</p>
    </div>
  </section>

  <!-- Claim Section -->
  <div class="container my-5">
    <div id="claimSection" class="text-center">
      <h2>#0005 THE BURNED FORTUNE</h2>
      <!-- Descripci贸n y lore -->
      <div class="nft-details">
        <p><strong>Description:</strong> Wealth isnt just about having money. Its about throwing it into the fire just because you can. This badge isnt for the cautious. Its not for the grinders. Its for the filthy rich, the ones who flex without hesitation.  Burn 100K $ADRIAN tokens. Prove you dont need them.  No utility. No perks. Just pure, unapologetic excess.  Yours to brag, yours to flaunt. You didnt just make it. You burned it to show you dont need it. Be real. Be reckless. Be Adrian. 梆</p>
        <p><strong>Attributes:</strong> Rarity: Badge | Edition: Open Edition</p>
      </div>
      
      <!-- Estado de conexi贸n -->
      <p id="walletStatus">Wallet not connected. Please connect via the menu.</p>

      <!-- Esta secci贸n se muestra cuando la wallet est茅 conectada -->
      <div id="claimInfo" style="display: none;">
        <div class="row justify-content-center mb-3">
          <div class="col-md-4">
            <img src="https://emerald-above-tick-265.mypinata.cloud/ipfs/bafybeihnmvtpqkibywrfmpleedvqpuclyk7sqgi5vfgvn4q37nthirxle4" class="img-fluid rounded" alt="Claim NFT">
          </div>
        </div>
        <p>Cost per NFT: <span id="nftCost">Loading...</span> ADRIAN</p>
        <p>Your claimed amount: <span id="userClaimed">0</span></p>
        <p>Max per user: <span id="maxPerUser">Loading...</span></p>
        <p>Total claimed: <span id="totalClaimed">Loading...</span></p>
        <p>Overall max claim: <span id="overallMax">Loading...</span></p>
        <p>Claim time: <span id="claimTime">Loading...</span></p>
        <div class="mb-3">
          <input type="number" id="quantity" class="form-control" placeholder="Quantity to claim" min="1" value="1">
        </div>
        <button id="claimBtn" class="btn btn-warning">Claim NFT(s)</button>
        <p class="status mt-3" id="statusMessage"></p>
        
        <div id="conditions" class="mt-4 text-start bg-dark p-3 rounded">
          <!-- Se mostrar谩n las condiciones -->
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div id="footer-placeholder"></div>
  <script>
    fetch('components/footer.html')
      .then(response => response.text())
      .then(html => { document.getElementById('footer-placeholder').innerHTML = html; })
      .catch(error => { console.error('Error loading footer:', error); });
  </script>
  
  <!-- Token Claim Script -->
  <script>
    /* 
      Configuraci贸n:
      - Contrato con el que interact煤a: 0xa92a8F5A47efC77da796dfD0827D07872E7D0429
      - Mint event: 6
      - Tokens needed per NFT: 100,000 ADRIAN tokens (del contrato 0x7E99075Ce287F1cF8cBCAaa6A1C7894e404fD7Ea)
    */
    const claimContractAddress = "0xa92a8F5A47efC77da796dfD0827D07872E7D0429";
    const claimEventId = 6;
    const requiredTokenAddress = "0x7E99075Ce287F1cF8cBCAaa6A1C7894e404fD7Ea";
    
    // Para este frontend, asumimos que el contrato de mint tiene una funci贸n mint() similar al anterior
    // y que el costo por NFT se fija en 100,000 ADRIAN tokens.
    const claimABI = [
      "function mint(uint256 eventId, uint256 quantity) external"
    ];
    
    // En este ejemplo, para simplificar, el costo lo forzamos a 100,000 tokens
    const costPerNFT = ethers.utils.parseUnits("100000", 18);
    
    let provider, signer, claimContract, userAddress;
    
    async function loadClaimInfo() {
      // En este ejemplo, podr铆as mostrar informaci贸n adicional, pero aqu铆 solo usamos placeholders
      document.getElementById("nftCost").innerText = "100,000";
      // Otros valores se dejar谩n en 0 o Loading...
    }
    
    async function updateConditions() {
      const conditionsDiv = document.getElementById("conditions");
      conditionsDiv.innerHTML = "";
      // Ejemplo: condici贸n de que el usuario tenga al menos 100k ADRIAN tokens
      try {
        const tokenContract = new ethers.Contract(requiredTokenAddress, ["function balanceOf(address account) view returns (uint256)"], provider);
        const userBalanceBN = await tokenContract.balanceOf(userAddress);
        const userBalance = parseFloat(ethers.utils.formatUnits(userBalanceBN, 18));
        const conditionMet = userBalance >= 100000;
        conditionsDiv.innerHTML += `<p>Has at least 100,000 ADRIAN tokens: ${conditionMet ? "Yes" : "No"} (Your balance: ${userBalance.toLocaleString()})</p>`;
      } catch (error) {
        console.error("Error checking conditions:", error);
      }
    }
    
    document.getElementById("quantity").addEventListener("input", updateConditions);
    
    document.getElementById("claimBtn").addEventListener("click", async () => {
      const quantity = document.getElementById("quantity").value;
      if (quantity <= 0) return;
      document.getElementById("statusMessage").innerText = "Processing mint...";
      
      try {
        // Ejecutar la funci贸n mint() del contrato (1:1 swap)
        const tx = await claimContract.mint(claimEventId, quantity);
        await tx.wait();
        document.getElementById("statusMessage").innerText = "Mint successful!";
        loadClaimInfo();
        updateConditions();
      } catch (error) {
        console.error("Mint failed:", error);
        document.getElementById("statusMessage").innerText = "Mint failed. Check console.";
      }
    });
    
    // Callback para cuando se conecta la wallet v铆a men煤 (menu2.js)
    window.onMenuWalletConnected = async function() {
      userAddress = window.menuUserAccount;
      provider = window.menuProvider;
      signer = window.menuSigner;
      console.log("onMenuWalletConnected: userAddress =", userAddress);
      document.getElementById("walletStatus").innerText = "Connected: " + userAddress;
      document.getElementById("claimInfo").style.display = "block";
      // Instanciar el contrato de mint usando el signer
      claimContract = new ethers.Contract(claimContractAddress, claimABI, signer);
      loadClaimInfo();
      updateConditions();
    };
    
    window.onMenuWalletDisconnected = function() {
      document.getElementById("walletStatus").innerText = "Wallet not connected. Please connect via the menu.";
      document.getElementById("claimInfo").style.display = "none";
    };
  </script>
  
  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
